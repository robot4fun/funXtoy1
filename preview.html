<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Interactive LED</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    .container {
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
      max-width: 400px;
      width: 100%;
      min-width: 0;
    }
    h1 { text-align: center; color: #333; margin-bottom: 30px; font-size: 28px; }
    .mode-section { margin-bottom: 25px; }
    .mode-section .section-title {
      display: none;
    }
    .section-title {
      font-size: 14px;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 12px;
      font-weight: bold;
    }
    .button-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 15px;
      word-break: break-word;
      overflow-wrap: anywhere;
      max-width: 100%;
      box-sizing: border-box;
    }
    .button-group.full { grid-template-columns: 1fr; }
    button {
      padding: 12px 16px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .mode-btn {
      background: #f0f0f0;
      color: #333;
      border: 2px solid #ddd;
    }
    .mode-btn:hover { background: #e0e0e0; }
    .mode-btn.active {
      background: #667eea;
      color: white;
      border-color: #667eea;
    }
    .action-btn {
      background: #667eea;
      color: white;
    }
    .action-btn:hover { background: #5568d3; }
    .action-btn:active { transform: scale(0.98); }
    .control-section {
      background: #f9f9f9;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 15px;
    }
    .slider-group {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }
    .slider-group label { min-width: 60px; font-size: 15px; }
    input[type="range"] {
      flex: 1;
      height: 6px;
      border-radius: 3px;
      background: #ddd;
      outline: none;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: #667eea;
      cursor: pointer;
    }
    input[type="range"]::-moz-range-thumb {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: #667eea;
      cursor: pointer;
      border: none;
    }
    .toggle {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px;
      background: white;
      border-radius: 6px;
      border: 1px solid #ddd;
    }
    .toggle-switch {
      width: 50px;
      height: 28px;
      background: #ccc;
      border-radius: 14px;
      position: relative;
      cursor: pointer;
      transition: background 0.3s;
    }
    .toggle-switch.active { background: #667eea; }
    .toggle-switch::after {
      content: '';
      position: absolute;
      width: 24px;
      height: 24px;
      background: white;
      border-radius: 50%;
      top: 2px;
      left: 2px;
      transition: left 0.3s;
    }
    .toggle-switch.active::after { left: 24px; }
    .lang-buttons {
      display: flex;
      gap: 8px;
      justify-content: center;
      margin-bottom: 20px;
    }
    .lang-btn {
      padding: 6px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      background: #fff;
      cursor: pointer;
      font-size: 12px;
      font-weight: bold;
      transition: all 0.3s;
    }
    .lang-btn.active {
      background: #667eea;
      color: white;
      border-color: #667eea;
    }
    .lang-btn:hover { background: #f0f0f0; }
  </style>
</head>
<body>
  <div class="container">
    <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 20px;">
      <svg width="160" height="50" viewBox="0 0 240 100" style="margin-right: 10px;">
        <!-- f (Blue) -->
        <text x="5" y="70" font-size="60" font-weight="bold" fill="#4169E1" font-family="Arial">f</text>
        <!-- u (Green) -->
        <text x="26" y="70" font-size="60" font-weight="bold" fill="#00CD00" font-family="Arial">u</text>
        <!-- n (Yellow) -->
        <text x="61" y="70" font-size="60" font-weight="bold" fill="#FFD700" font-family="Arial">n</text>
        <!-- X (Red) -->
        <text x="96" y="70" font-size="70" font-weight="bold" fill="#DC143C" font-family="Arial">X</text>
        <!-- edu (Black) -->
        <text x="142" y="70" font-size="60" font-weight="bold" fill="#000000" font-family="Arial">edu</text>
      </svg>
    </div>
    <div class="lang-buttons">
      <button class="lang-btn" onclick="setLanguage('en')">English</button>
      <button class="lang-btn" onclick="setLanguage('zh-TW')">繁體中文</button>
      <button class="lang-btn" onclick="setLanguage('zh-CN')">简体中文</button>
    </div>
        
    <div class="mode-section">
      <div class="section-title" id="modeTitle">Animation Mode</div>
      <div id="modeButtons" class="button-group" style="min-height: 50px;"></div>
    </div>
    
    <div id="controlPanel" class="control-section">
      <div class="slider-group">
        <label id="brightnessLabel">Brightness:</label>
        <input type="range" id="brightness" min="0" max="255" value="255" onchange="updateBrightness()">
        <span id="brightnessValue">255</span>
      </div>
    </div>
    
    <div id="colorPanel" class="control-section" style="display:none;">
      <div class="section-title" id="colorTitle">Color Selection</div>
      <div style="display: flex; gap: 10px; align-items: center;">
        <input type="color" id="colorPicker" value="#00ffff" onchange="updateColor()" style="width: 50px; height: 40px; border: none; border-radius: 4px; cursor: pointer;">
        <div style="flex: 1;">
          <div style="font-size: 12px; color: #666; margin-bottom: 5px;">R: <span id="colorR">0</span> G: <span id="colorG">255</span> B: <span id="colorB">255</span></div>
          <input type="text" id="colorHex" value="#00ffff" onchange="updateColorFromHex()" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-family: monospace; font-size: 12px;">
        </div>
      </div>
    </div>
    
    <div class="control-section" style="border-top: 1px solid #ddd; padding-top: 20px;">
      <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px; justify-content: space-between;">
        <label id="vibrationLabel" style="margin: 0; flex: 1; font-size: 13px; font-weight: bold;"><span id="vibrationText">Vibration Trigger (Auto Mode)</span></label>
        <div class="toggle-switch" id="autoModeToggle" onclick="toggleAutoMode()" style="margin: 0;"></div>
      </div>
    </div>
    
    <div class="status" style="font-size: 12px;">
      <strong id="statusTitle">Status:</strong> <span id="statusConnected">Connected to WiFi</span><br>
    </div>
  </div>

  <script>
    var currentMode = 0;
    var currentLang = 'en';

    // list of translation keys for each animation mode in order
    var modeKeys = ['rainbowCycle','randomFlash','colorPulse','chase','cylon','fire','noise','pacifica','pride','twinkle','demoRainbow','demoGlitter','demoConfetti','demoSinelon','demoJuggle','demoBPM', 'mono', 'clearLEDs'];

    // Multi-language translations
    var i18n = {
      'en': {
        'title': 'Interactive LED',
        'animationMode': 'Animation Mode',
        'rainbow': 'Rainbow',
        'flash': 'Flash',
        'pulse': 'Breathing',
        'chase': 'Chase',
        'brightness': 'Brightness:',
        'colorTitle': 'Color Selection',
        'colorSelection': 'Color Selection',
        'manualControl': 'Manual Control',
        'mono': 'Mono',
        'vibrationTrigger': 'Vibration Trigger',
        'clearLEDs': 'Clear LEDs',
        'cleared': 'LEDs cleared!',
        'status': 'Status:',
        'statusLabel': 'Status: ',
        'currentMode': 'Mode: ',
        'connected': 'Connected',
        // mode names
        'rainbowCycle': 'Neon',
        'randomFlash': 'Random Flash',
        'colorPulse': 'Color Pulse',
        // fx names
        'cylon': 'Cylon',
        'fire': 'Fire',
        'noise': 'Noise Wave',
        'pacifica': 'Pacifica',
        'pride': 'Pride2015',
        'twinkle': 'Twinkle Fox',
        'demoRainbow': 'Rainbow',
        'demoGlitter': 'Rainbow+Glitter',
        'demoConfetti': 'Confetti',
        'demoSinelon': 'Sinelon',
        'demoJuggle': 'Juggle',
        'demoBPM': 'BPM',
        'close': 'Close'
      },
      'zh-TW': {
        'title': '互動LED玩具',
        'animationMode': '動畫模式',
        'rainbow': '彩虹',
        'flash': '閃爍',
        'pulse': '呼吸燈',
        'chase': '跑馬燈',
        'brightness': '亮度:',
        'colorTitle': '顏色選擇',
        'colorSelection': '顏色選擇',
        'manualControl': '手動控制',
        'mono': '單色',
        'vibrationTrigger': '震動觸發',
        'clearLEDs': '關閉LED',
        'cleared': 'LED已清空！',
        'status': '狀態:',
        'statusLabel': '狀態: ',
        'currentMode': '模式: ',
        'connected': '已連接',
        // mode names
        'rainbowCycle': '霓虹',
        'randomFlash': '隨機閃爍',
        'colorPulse': '色彩跳動',
        // fx names
        'cylon': '賽安隆',
        'fire': '火焰',
        'noise': '雜訊波',
        'pacifica': '太平洋',
        'pride': '驕傲彩虹',
        'twinkle': '閃爍狐狸',
        'demoRainbow': '彩虹',
        'demoGlitter': '彩虹+亮粉',
        'demoConfetti': '彩帶',
        'demoSinelon': '單點來回',
        'demoJuggle': '交錯',
        'demoBPM': '節拍',
        'close': '關閉'
      },
      'zh-CN': {
        'title': '互动LED玩具',
        'animationMode': '动画模式',
        'rainbow': '彩虹',
        'flash': '闪烁',
        'pulse': '呼吸灯',
        'chase': '跑马灯',
        'brightness': '亮度:',
        'colorTitle': '颜色选择',
        'colorSelection': '颜色选择',
        'manualControl': '手动控制',
        'mono': '单色',
        'vibrationTrigger': '振动触发',
        'clearLEDs': '关闭',
        'cleared': 'LED已清空！',
        'status': '状态:',
        'statusLabel': '状态: ',
        'currentMode': '模式: ',
        'connected': '已连接',
        // mode names
        'rainbowCycle': '霓虹',
        'randomFlash': '随机闪烁',
        'colorPulse': '色彩跳动',
        // fx names
        'cylon': '赛安隆',
        'fire': '火焰',
        'noise': '噪声波',
        'pacifica': '太平洋',
        'pride': '骄傲彩虹',
        'twinkle': '闪烁狐狸',
        'demoRainbow': '彩虹',
        'demoGlitter': '彩虹+亮片',
        'demoConfetti': '彩带',
        'demoSinelon': '單點往返',
        'demoJuggle': '抛球',
        'demoBPM': '节拍',
        'close': '关闭'
      }
    };
    
    // Get translation
    function t(key) {
      return i18n[currentLang][key] || i18n['en'][key] || key;
    }
    
    // helper: build the mode buttons dynamically
    function createModeButtons() {
      var container = document.getElementById('modeButtons');
      if (!container) return;
      container.innerHTML = '';
      modeKeys.forEach(function(key, idx) {
        var btn = document.createElement('button');
        btn.className = 'mode-btn' + (idx === currentMode ? ' active' : '');
        btn.id = 'modeBtn' + idx;
        btn.textContent = t(key);
        btn.setAttribute('data-mode', idx);
        btn.addEventListener('click', function() {
          setMode(idx);
        });
        container.appendChild(btn);
      });

    }

    // Update UI with current language
    function updateUI() {
      document.title = t('title');
      document.getElementById('modeTitle').textContent = t('animationMode');
      document.getElementById('brightnessLabel').textContent = t('brightness');
      document.getElementById('colorTitle').textContent = t('colorTitle');
      document.getElementById('vibrationText').textContent = t('vibrationTrigger') + ' (Auto Mode)';

      // rebuild/refresh mode buttons text
      createModeButtons();

      var langBtns = document.querySelectorAll('.lang-btn');
      for (var i = 0; i < langBtns.length; i++) {
        langBtns[i].classList.remove('active');
      }
      if (currentLang === 'en') langBtns[0].classList.add('active');
      else if (currentLang === 'zh-TW') langBtns[1].classList.add('active');
      else if (currentLang === 'zh-CN') langBtns[2].classList.add('active');
    }
    
    // Detect browser language and update
    function detectLanguage() {
      var browserLang = navigator.language || navigator.userLanguage;
      if (browserLang.indexOf('zh-Hans') !== -1 || browserLang === 'zh-CN') {
        currentLang = 'zh-CN';
      } else if (browserLang.indexOf('zh') !== -1) {
        currentLang = 'zh-TW';
      } else {
        currentLang = 'en';
      }
    }
    
    // Change language
    function setLanguage(lang) {
      currentLang = lang;
      updateUI();
      updateStatus(); // 語言切換時同步狀態
      // 高亮語言按鈕即時顯示
      setTimeout(function() {
        var langBtns = document.querySelectorAll('.lang-btn');
        langBtns.forEach(btn => btn.classList.remove('active'));
        if (lang === 'en') langBtns[0].classList.add('active');
        else if (lang === 'zh-TW') langBtns[1].classList.add('active');
        else if (lang === 'zh-CN') langBtns[2].classList.add('active');
      }, 0);
    }
    
    function setMode(mode) {
      currentMode = mode;
      fetch('/api/setMode?mode=' + mode)
        .then(function(r) { return r.json(); })
        .then(function(data) {
          // update status label
          var modes = modeKeys.map(function(k){ return t(k); });
          // toggle active button
          modeKeys.forEach(function(_, idx) {
            var btn = document.getElementById('modeBtn' + idx);
            if (btn) btn.classList.toggle('active', idx === mode);
          });
          // Mono顯示顏色面板
          var colorPanel = document.getElementById('colorPanel');
          if (modeKeys[mode] === 'mono') {
            colorPanel.style.display = '';
          } else {
            colorPanel.style.display = 'none';
          }
        })
        .catch(function(e) { console.error('Error setting mode:', e); });
    }
    
    function updateBrightness() {
      var val = document.getElementById('brightness').value;
      document.getElementById('brightnessValue').textContent = val;
      fetch('/api/setBrightness?value=' + val)
        .then(function(r) { return r.json(); })
        .catch(function(e) { console.log(e); });
    }
    
    function toggleAutoMode() {
      fetch('/api/toggleAuto')
        .then(function(r) { return r.json(); })
        .then(function(data) {
          console.log('toggleAuto response:', data);
          updateStatus();
        });
    }
    
    function updateAutoModeToggle(active) {
      var toggle = document.getElementById('autoModeToggle');
      if (toggle) {
        toggle.classList.toggle('active', active);
      }
    }

    function updateStatus() {
      fetch('/api/status')
        .then(r => r.json())
        .then(data => {
          document.getElementById('statusConnected').textContent = data.autoMode ? t('connected') : '';
          // 按鈕同步
          currentMode = data.mode;
          var buttons = document.querySelectorAll('.mode-btn');
          buttons.forEach((btn, idx) => {
            btn.classList.toggle('active', idx === currentMode);
          });
          // Mono顯示顏色面板
          var colorPanel = document.getElementById('colorPanel');
          if (modeKeys[currentMode] === 'mono') {
            colorPanel.style.display = '';
          } else {
            colorPanel.style.display = 'none';
          }
          // 震動開關同步
          updateAutoModeToggle(data.autoMode);
        });
    }

    // Color functions
    function hexToRgb(hex) {
      var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
      return result ? {
        r: parseInt(result[1], 16),
        g: parseInt(result[2], 16),
        b: parseInt(result[3], 16)
      } : { r: 0, g: 255, b: 255 };
    }
    
    function rgbToHex(r, g, b) {
      return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
    }
    
    function updateColor() {
      var hex = document.getElementById('colorPicker').value;
      var rgb = hexToRgb(hex);
      document.getElementById('colorHex').value = hex;
      document.getElementById('colorR').textContent = rgb.r;
      document.getElementById('colorG').textContent = rgb.g;
      document.getElementById('colorB').textContent = rgb.b;
      
      // Send to device
      fetch('/api/setColor?r=' + rgb.r + '&g=' + rgb.g + '&b=' + rgb.b)
        .then(function(r) { return r.json(); })
        .catch(function(e) { console.log(e); });
    }
    
    function updateColorFromHex() {
      var hex = document.getElementById('colorHex').value;
      if (hex.startsWith('#') && hex.length === 7) {
        document.getElementById('colorPicker').value = hex;
        updateColor();
      }
    }
    
    window.onload = function() {
      console.log('Page loaded');
      if (typeof modeKeys === 'undefined' || !modeKeys) {
        console.error('modeKeys not defined');
      } else {
        console.log('modeKeys defined:', modeKeys.length);
      }
      createModeButtons();
      detectLanguage();
      updateUI();
      updateStatus();
      // Update status every 2 seconds
      setInterval(updateStatus, 2000);
    };
  </script>
</body>
</html>
